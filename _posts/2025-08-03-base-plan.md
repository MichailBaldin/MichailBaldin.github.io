---
layout: post
title: Микросервисная архитектура онлайн-магазина: идея и план реализации
date: 2025-08-03
tags: [go, микросервисы, онлайн-магазин, highload, ddd, api-gateway, user-service, product-service]
---

# Цель проекта

Создание технологического стенда в виде онлайн-магазина, который решает двойную задачу:
- **Демонстрационная площадка** — фиксация и демонстрация освоенных технологий
- **Готовый бойлерплейт** — база для быстрого тестирования и интеграции новых технологий

Выбор онлайн-магазина обусловлен понятностью бизнес-логики и естественным соответствием принципам микросервисной архитектуры.

# Архитектурные принципы

## Основные принципы микросервисов
- **Автономность сервисов** — независимая разработка, развертывание и масштабирование
- **Единственная ответственность** — каждый сервис решает конкретную бизнес-задачу  
- **Децентрализованное управление** — отсутствие единой точки управления данными

## Проектные подходы
- **Domain-Driven Design (DDD)** — выделение bounded contexts для определения границ сервисов
- **Database-per-Service** — изолированные базы данных для каждого сервиса
- **API-First** — проектирование интерфейсов перед реализацией

# Архитектура системы

## Состав микросервисов

| Сервис | Ответственность |
|--------|----------------|
| **API Gateway** | Маршрутизация запросов, централизованная точка входа |
| **User Service** | Управление пользователями и профилями |
| **Product Service** | Каталог товаров, управление ассортиментом |
| **Order Service** | Создание и управление заказами |
| **Payment Service** | Обработка платежей, интеграция с платежными системами |
| **Notification Service** | Telegram уведомления |

## Технологический стек

**Backend**: Go (высокая производительность, отличная поддержка concurrency)  
**База данных**: PostgreSQL для основных сервисов  
**Структура проекта**: Монорепозиторий с Go workspaces  
**Оркестрация**: Docker Compose для управления сервисами  
**Автоматизация**: Makefile для централизованного запуска  
**API**: REST с обязательным версионированием (`/api/v1/...`)

# Структура проекта

## Монорепозиторий с Go workspaces

Все сервисы будут размещены в едином репозитории для удобства презентации и разработки:

```
ecommerce-microservices/
├── go.work                    # Go workspace configuration
├── docker-compose.yml         # Оркестрация всех сервисов
├── Makefile                   # Централизованное управление
├── .env                       # Environment variables
├── services/
│   ├── api-gateway/
│   │   ├── go.mod
│   │   ├── main.go
│   │   ├── handlers/
│   │   └── middleware/
│   ├── user-service/
│   │   ├── go.mod
│   │   ├── main.go
│   │   ├── handlers/
│   │   ├── models/
│   │   └── database/
│   └── product-service/
│       ├── go.mod
│       ├── main.go
│       ├── handlers/
│       ├── models/
│       └── database/
└── shared/                    # Общие библиотеки и utils
    ├── logger/
    ├── config/
    └── httputils/
```

**Преимущества подхода:**
- Простота клонирования и запуска всего проекта
- Централизованное управление зависимостями через go.work
- Единая CI/CD конфигурация
- Возможность независимой разработки каждого сервиса

# План поэтапной реализации

## Этап 1: Базовые сервисы

**Цель**: Создание основной функциональности с REST API

**Порядок разработки:**
1. User Service — управление пользователями
2. Product Service — каталог товаров  
3. API Gateway — центральная точка входа

**API endpoints:**

```yaml
# User Service
POST   /api/v1/users           # Создание пользователя
GET    /api/v1/users/{id}      # Получение пользователя
PUT    /api/v1/users/{id}      # Обновление пользователя  
DELETE /api/v1/users/{id}      # Удаление пользователя

# Product Service  
POST   /api/v1/products        # Создание товара
GET    /api/v1/products/{id}   # Получение товара
PUT    /api/v1/products/{id}   # Обновление товара
DELETE /api/v1/products/{id}   # Удаление товара

# API Gateway
# Проксирование всех запросов к соответствующим сервисам
```

## Этап 2: Расширение функциональности

- Order Service — создание и управление заказами
- Payment Service — обработка платежей  
- Notification Service — Telegram уведомления

## Этап 3: Инфраструктурные улучшения

- Мониторинг и метрики
- Централизованное логирование
- Автоматические тесты

# Ключевые технические решения

## Управление проектом
- **Go workspaces**: Независимая разработка сервисов в монорепе
- **Docker Compose**: Оркестрация всех сервисов и баз данных
- **Makefile**: Централизованные команды для сборки, запуска и тестирования

## Git Flow
- **main** — production-ready код, только стабильные релизы
- **develop** — основная ветка разработки, интеграция изменений
- **feature/** — разработка новой функциональности (`feature/user-registration`)
- **hotfix/** — критические исправления для production

```bash
# Стандартный workflow
git checkout develop
git pull origin develop
git checkout -b feature/payment-service
# ... разработка ...
git push origin feature/payment-service
# Pull Request: feature/payment-service -> develop
```

## Управление данными
- **Database-per-Service**: Каждый сервис имеет собственную БД PostgreSQL
- **Простые REST API**: Синхронное взаимодействие между сервисами
- **JSON**: Стандартный формат обмена данными

## Базовая инфраструктура
- **Health checks**: Эндпоинт `/health` для каждого сервиса
- **Environment configuration**: Настройки через переменные окружения
- **Structured logging**: JSON логи с уровнями (INFO, ERROR, DEBUG)

## Версионирование API
- Семантическое версионирование API (`/api/v1/`, `/api/v2/`)
- Документация через комментарии в коде
- Простые HTTP status codes для ответов

# Следующие шаги

## Настройка окружения
```bash
# Клонирование и запуск всего проекта одной командой
git clone <repo>
cd ecommerce-microservices
make up
```

## План разработки
1. **Настройка монорепо** — Go workspaces + Docker Compose + Makefile
2. **User Service** — базовые CRUD операции для пользователей  
3. **API Gateway** — простой HTTP роутер и прокси
4. **Product Service** — каталог товаров с базовой фильтрацией

## Команды Makefile
```makefile
make setup     # Инициализация проекта
make build     # Сборка всех сервисов  
make up        # Запуск через docker-compose
make down      # Остановка всех сервисов
make test      # Запуск тестов
make clean     # Очистка артефактов сборки
make logs      # Просмотр логов всех сервисов
```

## Примеры базовой конфигурации

**.env файл:**
```bash
# Database
POSTGRES_USER=postgres
POSTGRES_PASSWORD=password
POSTGRES_DB=ecommerce

# Services ports
USER_SERVICE_PORT=8001
PRODUCT_SERVICE_PORT=8002
API_GATEWAY_PORT=8000

# Logging
LOG_LEVEL=info
LOG_FORMAT=json
```

**Health check эндпоинт:**
```go
// GET /health
{
  "status": "ok",
  "service": "user-service",
  "version": "1.0.0",
  "timestamp": "2025-08-03T10:00:00Z"
}
```